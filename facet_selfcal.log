
wsclean -no-update-model-required -minuv-l 200.0 -maxuv-l 200000 -beam-size 2  -size 1600 1600 -reorder \
-weight briggs 0.0 -clean-border 1 -parallel-reordering 4 -mgain 0.8 -data-column DATA -padding 1.4 -join-channels \
-channels-out 3 -auto-mask 2.5 -auto-threshold 0.5 -fit-spectral-pol 2 -pol i  -gridder wgridder -name image_FB_outer_uvcut -scale 0.5arcsec \
-nmiter 12 -niter 15000 ../1?0sMHz/L723586_SB001_uaveraged_v_12E068069t_1*

wsclean -no-update-model-required -minuv-l 200.0 -maxuv-l 2000000  -size 1600 1600 -reorder \
-weight briggs 0.0 -clean-border 1 -parallel-reordering 4 -mgain 0.8 -data-column DATA -padding 1.4 -join-channels \
-channels-out 3 -auto-mask 2.5 -auto-threshold 0.5 -fit-spectral-pol 2 -pol i  -gridder wgridder -name image_FB_ILT -scale 0.5arcsec \
-nmiter 12 -niter 15000 -circular-beam  ../1?0sMHz/L723586_SB001_uaveraged_v_12E068069t_1*

wsclean -no-update-model-required -minuv-l 100.0 -maxuv-l 300000  -size 4000 4000 -reorder \
-weight briggs 0.0 -clean-border 1 -parallel-reordering 4 -mgain 0.8 -data-column DATA -padding 1.4 -join-channels \
-channels-out 3 -auto-mask 2.5 -auto-threshold 0.5 -fit-spectral-pol 4 -pol i  -gridder wgridder -name OJ287_averaged_FB_Field -scale 8arcsec \
-nmiter 12 -niter 15000  OJ287_averaged.MS

************ GOOD 2arcsec  image **************
hshetgaonkar@lonode001:/scratch/DATA1/OJ287/facet_selfcal/120sMHz/image_FB_outer_uvcut-MFS-image.fits
contours @ FB_outer_uvcat_2arcsec_3rms.ctr
************ GOOD 2arcsec  image **************

wsclean -no-update-model-required -minuv-l 40000 -maxuv-l 2000000 -beam-size 0.4 -size 1600 1600 -reorder \
-weight briggs -0.5 -clean-border 1 -parallel-reordering 4 -mgain 0.8 -data-column DATA -padding 1.4 -join-channels \
-channels-out 4 -auto-mask 2.5 -auto-threshold 0.5 -fit-spectral-pol 10 -baseline-averaging 6.13592315154 -pol i  -gridder wgridder -name image_FB_ILT_briggs-0.5 -scale 0.075arcsec \
-nmiter 12 -niter 15000 -circular-beam  ../1?0sMHz/L723586_SB001_uaveraged_v_12E068069t_1*

DP3 'steps=[avg,count]' avg.type=averager avg.freqstep=10 msin.orderms=False msin.missingdata=True msout.overwrite=True msout.writefullresflag=False \
count.savetojson=True count.jsonfilename=out.json msin.datacolumn=DATA msout.datacolumn=DATA numthreads=15 \
'msin=[L723586_SB001_uaveraged_v_12E068069t_121MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_123MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_125MHz.msdpppconcat,
L723586_SB001_uaveraged_v_12E068069t_127MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_129MHz.msdpppconcat]' msout=L723586_120s_averaged.MS msout.storagemanager=dysco ; \


DP3 'steps=[avg,count]' avg.type=averager avg.freqstep=10 msin.orderms=False msin.missingdata=True msout.overwrite=True msout.writefullresflag=False \
count.savetojson=True count.jsonfilename=out.json msin.datacolumn=DATA msout.datacolumn=DATA numthreads=15 \
'msin=[L723586_SB001_uaveraged_v_12E068069t_130MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_132MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_134MHz.msdpppconcat,
L723586_SB001_uaveraged_v_12E068069t_136MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_138MHz.msdpppconcat]' msout=L723586_130s_averaged.MS msout.storagemanager=dysco ; \
DP3 'steps=[avg,count]' avg.type=averager avg.freqstep=10 msin.orderms=False msin.missingdata=True msout.overwrite=True msout.writefullresflag=False \
count.savetojson=True count.jsonfilename=out.json msin.datacolumn=DATA msout.datacolumn=DATA numthreads=15 \
'msin=[L723586_SB001_uaveraged_v_12E068069t_140MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_142MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_144MHz.msdpppconcat,
L723586_SB001_uaveraged_v_12E068069t_146MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_148MHz.msdpppconcat]' msout=L723586_140s_averaged.MS msout.storagemanager=dysco ; \
DP3 'steps=[avg,count]' avg.type=averager avg.freqstep=10 msin.orderms=False msin.missingdata=True msout.overwrite=True msout.writefullresflag=False \
count.savetojson=True count.jsonfilename=out.json msin.datacolumn=DATA msout.datacolumn=DATA numthreads=15 \
'msin=[L723586_SB001_uaveraged_v_12E068069t_150MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_152MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_154MHz.msdpppconcat,
L723586_SB001_uaveraged_v_12E068069t_156MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_158MHz.msdpppconcat]' msout=L723586_150s_averaged.MS msout.storagemanager=dysco ; \
DP3 'steps=[avg,count]' avg.type=averager avg.freqstep=10 msin.orderms=False msin.missingdata=True msout.overwrite=True msout.writefullresflag=False \
count.savetojson=True count.jsonfilename=out.json msin.datacolumn=DATA msout.datacolumn=DATA numthreads=15 \
'msin=[L723586_SB001_uaveraged_v_12E068069t_160MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_162MHz.msdpppconcat, L723586_SB001_uaveraged_v_12E068069t_164MHz.msdpppconcat,
L723586_SB001_uaveraged_v_12E068069t_166MHz.msdpppconcat]' msout=L723586_160s_averaged.MS msout.storagemanager=dysco

This worked. Running selfcal again on this small data:
python /scratch/WORK/hrishi/lofar-vlbi/lofar_facet_selfcal/facetselfcal.py L723586_1?0s_averaged.MS --imsize=2048 -i OJ287_facetselfcal_1 --pixelscale=0.075 --robust=0 --skymodelpointsource=0.8 \
--uvmin=200 --soltype-list="['phaseonly','amplitudeonly','fulljones']" --soltypecycles-list="[0,0,2]" --solint-list="['5min','5min','10min']" --nchan-list="[1,1,1]" \
--smoothnessconstraint-list="[5.0,5.0,5.0]" --docircular --antennaconstraint-list="['alldutch',None,None]" --stop=10 \
--helperscriptspath=/scratch/WORK/hrishi/lofar-vlbi/lofar_facet_selfcal --helperscriptspathh5merge=/scratch/WORK/hrishi/lofar-vlbi/lofar_helpers/ > facet_selfcal_13thMarch_1.log 2>&1
This failed on full jones step:
Fulljones and flagging not implemtened
Traceback (most recent call last):
  File "/scratch/WORK/hrishi/lofar-vlbi/lofar_facet_selfcal/facetselfcal.py", line 6660, in <module>
    main()
  File "/scratch/WORK/hrishi/lofar-vlbi/lofar_facet_selfcal/facetselfcal.py", line 6587, in main
    calibrateandapplycal(mslist, i, args, solint_list, nchan_list, args['soltype_list'], soltypecycles_list,\
  File "/scratch/WORK/hrishi/lofar-vlbi/lofar_facet_selfcal/facetselfcal.py", line 5185, in calibrateandapplycal
    runDPPPbase(ms, solint_list[soltypenumber][msnumber], nchan_list[soltypenumber][msnumber], parmdb, soltype, \
  File "/scratch/WORK/hrishi/lofar-vlbi/lofar_facet_selfcal/facetselfcal.py", line 5635, in runDPPPbase
    raise Exception('Fulljones and flagging not implemtened')
Exception: Fulljones and flagging not implemtened


Also, this was very slow. Trying to average more:
DP3 'steps=[avg,count]' avg.type=averager avg.timestep=4 msin.orderms=False msout.overwrite=True \
count.savetojson=True count.jsonfilename=out.json msin.datacolumn=DATA msout.datacolumn=DATA  \
'msin=[L723586_120s_averaged.MS,L723586_130s_averaged.MS,L723586_140s_averaged.MS,L723586_150s_averaged.MS,L723586_160s_averaged.MS]' msout=OJ287_averaged.MS

python /scratch/WORK/hrishi/lofar-vlbi/lofar_facet_selfcal/facetselfcal.py OJ287_averaged.MS --imsize=2048 -i OJ287_averaged_selfcal --pixelscale=0.075 --robust=0 --skymodelpointsource=0.8 \
--uvmin=200 --soltype-list="['scalarphasediff','scalarphase','scalarcomplexgain']" --soltypecycles-list="[0,0,3]" --solint-list="['5min','5min','10min']" --nchan-list="[1,1,1]" \
--smoothnessconstraint-list="[5.0,5.0,5.0]" --docircular --antennaconstraint-list="['alldutch',None,None]" --stop=6 \
--helperscriptspath=/scratch/WORK/hrishi/lofar-vlbi/lofar_facet_selfcal --helperscriptspathh5merge=/scratch/WORK/hrishi/lofar-vlbi/lofar_helpers/ > facet_selfcal_13thMarch_1.log 2>&1

This too is slow. Averaging a lot more!
DP3 'steps=[avg,count]' avg.type=averager avg.timestep=8 msin.orderms=False msout.overwrite=True \
count.savetojson=True count.jsonfilename=out.json msin.datacolumn=DATA msout.datacolumn=DATA  \
"'msin=[L723586_120s_averaged.MS,L723586_130s_averaged.MS,L723586_140s_averaged.MS,L723586_150s_averaged.MS,L723586_160s_averaged.MS]' msout=OJ287_averaged.MS
For this:
MSWriter msout.
  output MS:      /scratch/DATA1/OJ287/facet_selfcal/averaged/OJ287_averaged.MS
  nchan:          48
  ncorrelations:  4
  nbaselines:     2775
  ntimes:         450
  time interval:  32.0445
  DATA column:    DATA
  FLAG column:    FLAG
  WEIGHT column:  WEIGHT_SPECTRUM
  Compressed:     no
"  use thread:     true

Including 160s increased off source rms. Trying without it
DP3 'steps=[avg,count]' avg.type=averager avg.timestep=8 msin.orderms=False msout.overwrite=True \
count.savetojson=True count.jsonfilename=out.json msin.datacolumn=DATA msout.datacolumn=DATA  \
'msin=[L723586_120s_averaged.MS,L723586_130s_averaged.MS,L723586_140s_averaged.MS,L723586_150s_averaged.MS]' msout=OJ287_averaged.MS
MSWriter msout.
  output MS:      /scratch/DATA1/OJ287/facet_selfcal/averaged/OJ287_averaged.MS
  nchan:          40
  ncorrelations:  4
  nbaselines:     2775
  ntimes:         450
  time interval:  32.0445
  DATA column:    DATA
  FLAG column:    FLAG
  WEIGHT column:  WEIGHT_SPECTRUM
  Compressed:     no
  use thread:     true

Now started facet self cal on this very_averaged data.
python /scratch/WORK/hrishi/lofar-vlbi/lofar_facet_selfcal/facetselfcal.py ../OJ287_averaged.MS --imsize=2048 -i OJ287_averaged_selfcal --pixelscale=0.075 --robust=0 --skymodelpointsource=0.8 \
 --uvmin=200 --soltype-list="['scalarphasediff','scalarphase','scalarcomplexgain']" --soltypecycles-list="[0,0,3]" --solint-list="['5min','5min','7min']" --nchan-list="[1,1,1]" \
 --smoothnessconstraint-list="[5.0,5.0,5.0]" --docircular --antennaconstraint-list="['alldutch',None,None]" --stop=6 \
 --helperscriptspath=/scratch/WORK/hrishi/lofar-vlbi/lofar_facet_selfcal --helperscriptspathh5merge=/scratch/WORK/hrishi/lofar-vlbi/lofar_helpers/ > facet_selfcal_13thMarch_1.log 2>&1
This seemed to work. Hotspot is more clear. Jet not so much.It is in /scratch/DATA1/OJ287/facet_selfcal/very_averaged/facet_selfcal2/. Checking diagnostics.


On the side, I think the CORRECTED_DATA col in '' has the first results of delay cal applied. Trying to average and image this.
DP3 'steps=[avg,count]' avg.type=averager avg.timestep=16 avg.freqstep=40 msin.orderms=False msout.overwrite=True \
count.savetojson=True count.jsonfilename=out.json msin.datacolumn=CORRECTED_DATA msout.datacolumn=DATA  \
'msin=[L723586_SB001_uv_12E068069t_121MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_123MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_125MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_127MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_129MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_130MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_132MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_134MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_136MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_138MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_140MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_142MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_144MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_146MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_148MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_150MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_152MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_154MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_156MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_158MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_160MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_162MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_164MHz.msdpppconcat, \
L723586_SB001_uv_12E068069t_166MHz.msdpppconcat, \
]' \
msout=OJ287_CORRECTRED_averaged.MS
MSWriter msout.
  output MS:      /data/LOFAR/P6/OJ287/LC12_Mooney_June/OJ287_PIPELINE/Delay-Calibration/OJ287_CORRECTRED_averaged.MS
  nchan:          100
  ncorrelations:  4
  nbaselines:     2775
  ntimes:         899
  time interval:  16.0222
  DATA column:    DATA
  FLAG column:    FLAG
  WEIGHT column:  WEIGHT_SPECTRUM
  Compressed:     no
  use thread:     true

Put this data in /scratch/DATA1/OJ287/facet_selfcal/CORRECTED_DATA/
Now imaging as earlier:
wsclean -no-update-model-required -minuv-l 200.0 -maxuv-l 200000 -beam-size 2 -size 1600 1600 -reorder \
-weight briggs 0.0 -clean-border 1 -parallel-reordering 4 -mgain 0.8 -data-column DATA -padding 1.4 -join-channels \
-channels-out 3 -auto-mask 2.5 -auto-threshold 0.5 -fit-spectral-pol 2 -pol i  -gridder wgridder -name image_FB_outer_uvcut -scale 0.5arcsec \
-nmiter 12 -niter 15000 OJ287_CORRECTRED_averaged.MS

wsclean -no-update-model-required -minuv-l 20000 -maxuv-l 4000000 -circular-beam -size 1600 1600 -reorder \
-weight briggs 0.0 -clean-border 1 -parallel-reordering 4 -mgain 0.8 -data-column DATA -padding 1.4 -join-channels \
-channels-out 3 -auto-mask 2.5 -auto-threshold 0.5 -fit-spectral-pol 2 -pol i  -gridder wgridder -name image_FB_ILT -scale 0.075arcsec \
-nmiter 12 -niter 15000 OJ287_CORRECTRED_averaged.MS


The CORRECTED_DATA approach failed.

Checking facet self cal by giving region for cleaning: 
python /scratch/WORK/hrishi/lofar-vlbi/lofar_facet_selfcal/facetselfcal.py ../OJ287_averaged.MS --imsize=2048 -i OJ287_averaged_selfcal --pixelscale=0.075 \
--robust=-0.5 --skymodelpointsource=1  --uvmin=40000 --soltype-list="['scalarphasediff','scalarphase','scalarcomplexgain']" --soltypecycles-list="[0,1,3]" --fitsmask=../../oj287_jet_mask.fits \
--solint-list="['5min','10min','20min']" --nchan-list="[1,1,1]"  --smoothnessconstraint-list="[5.0,5.0,10.0]" --docircular --antennaconstraint-list="['alldutch',None,None]" \
--stop=10  --helperscriptspath=/scratch/WORK/hrishi/lofar-vlbi/lofar_facet_selfcal --helperscriptspathh5merge=/scratch/WORK/hrishi/lofar-vlbi/lofar_helpers/ > facet_selfcal_14thMarch_2_.log 2>&1
